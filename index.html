<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>NdLMS ‚Äì GitHub File Uploader</title>

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#1e3c72,#2a5298);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.card {
  background: #fff;
  width: 460px;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0,0,0,.3);
}
h2 { margin-top: 0; }
input[type=file] { width: 100%; margin: 10px 0; }

.file-box {
  border: 2px dashed #cbd5e1;
  border-radius: 10px;
  padding: 10px;
  min-height: 90px;
  background: #f8fafc;
  margin-bottom: 12px;
  font-size: 14px;
}
.file {
  background: #e2e8f0;
  padding: 6px 8px;
  border-radius: 6px;
  margin-bottom: 6px;
}
.empty { color: #64748b; }

button {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 8px;
  background: #2563eb;
  color: #fff;
  font-size: 16px;
  cursor: pointer;
}
button:disabled { opacity: .6; }

.progress {
  margin-top: 12px;
  width: 100%;
  height: 10px;
  background: #e5e7eb;
  border-radius: 999px;
  overflow: hidden;
}
.progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg,#22c55e,#16a34a);
  transition: width .3s;
}
.progress-text {
  font-size: 13px;
  margin-top: 6px;
  color: #475569;
}

.links a {
  display: block;
  font-size: 13px;
  margin-top: 4px;
}

/* Popup decode log */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}
.popup {
  background: #fff;
  width: 520px;
  max-height: 360px;
  padding: 16px;
  border-radius: 12px;
  overflow: auto;
  font-family: monospace;
  font-size: 13px;
  white-space: pre-wrap;
}
</style>
</head>

<body>

<div class="card">
  <h2>üì§ NdLMS GitHub Uploader</h2>
  <p>Upload nhi·ªÅu file ‚Üí repo <b>file</b></p>

  <input type="file" id="files" multiple>

  <div class="file-box" id="fileBox">
    <div class="empty">Ch∆∞a c√≥ file n√†o ƒë∆∞·ª£c ch·ªçn</div>
  </div>

  <button id="btn" onclick="upload()">üíæ L∆∞u & Upload</button>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="progress-text" id="progressText"></div>

  <div class="links" id="links"></div>
</div>

<!-- Decode log popup -->
<div class="overlay" id="overlay">
  <div class="popup" id="popup"></div>
</div>

<script>
const fileInput = document.getElementById('files');
const fileBox = document.getElementById('fileBox');
const progressBar = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');
const overlay = document.getElementById('overlay');
const popup = document.getElementById('popup');

fileInput.onchange = () => {
  const fs = [...fileInput.files];
  if (!fs.length) {
    fileBox.innerHTML = '<div class="empty">Ch∆∞a c√≥ file n√†o ƒë∆∞·ª£c ch·ªçn</div>';
    return;
  }
  fileBox.innerHTML = fs.map(f =>
    `<div class="file">üìÑ ${f.name} (${(f.size/1024).toFixed(1)} KB)</div>`
  ).join('');
};

function setProgress(p, text) {
  progressBar.style.width = p + '%';
  progressText.innerText = text;
}

function logDecode(text) {
  overlay.style.display = 'flex';
  popup.textContent += text + "\n\n";
}

async function upload() {
  const files = [...fileInput.files];
  if (!files.length) return alert('Ch∆∞a ch·ªçn file');

  btn.disabled = true;
  popup.textContent = '';
  setProgress(5, 'Chu·∫©n b·ªã d·ªØ li·ªáu...');

  const payload = [];
  let done = 0;

  for (const f of files) {
    const buf = await f.arrayBuffer();
    const bytes = new Uint8Array(buf);

    let decoded;
    try {
      decoded = new TextDecoder().decode(bytes.slice(0, 300));
    } catch {
      decoded = '[Binary data]';
    }

    logDecode(
`üìÑ FILE: ${f.name}
üì¶ SIZE: ${f.size} bytes
üß™ DECODE PREVIEW (first 300 bytes):
${decoded}
-------------------------------`
    );

    const base64 = btoa(String.fromCharCode(...bytes));
    payload.push({ name: f.name, content: base64 });

    done++;
    setProgress(5 + Math.round(done / files.length * 40),
                `ƒê√£ x·ª≠ l√Ω ${done}/${files.length} file`);

    await new Promise(r => setTimeout(r, 600));
  }

  try {
    setProgress(55, 'G·ª≠i workflow GitHub Actions...');

    await fetch(
      'https://api.github.com/repos/ntnhan306/ndlms/actions/workflows/upload.yml/dispatches',
      {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer YOUR_WORKFLOW_TOKEN',
          'Accept': 'application/vnd.github+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          ref: 'main',
          inputs: { files: JSON.stringify(payload) }
        })
      }
    );

    setProgress(100, 'Ho√†n t·∫•t ‚Äì workflow ƒëang ch·∫°y');

    setTimeout(() => overlay.style.display = 'none', 1500);

    document.getElementById('links').innerHTML = files.map(f =>
      `<a target="_blank"
         href="https://raw.githubusercontent.com/ntnhan306/file/main/${f.name}">
         üîó ${f.name}
       </a>`
    ).join('');

  } catch (e) {
    alert('Upload th·∫•t b·∫°i');
    setProgress(0, '');
    overlay.style.display = 'none';
  }

  btn.disabled = false;
}
</script>

</body>
</html>
