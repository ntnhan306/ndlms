<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>GitHub File Uploader</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #fff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      background: #fff;
      color: #333;
      width: 420px;
      padding: 24px;
      border-radius: 14px;
      box-shadow: 0 20px 40px rgba(0,0,0,.25);
    }
    h2 { margin-top: 0; }
    input[type=file] {
      width: 100%;
      margin: 12px 0;
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #2563eb;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled { opacity: .6; }
    .links a { display: block; font-size: 13px; }

    /* Popup */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.5);
      display: none;
      align-items: center;
      justify-content: center;
    }
    .popup {
      background: #fff;
      color: #333;
      padding: 20px;
      border-radius: 12px;
      width: 300px;
      text-align: center;
    }
    .popup.success { border-left: 6px solid #22c55e; }
    .popup.error { border-left: 6px solid #ef4444; }
      .file-box {
      border: 2px dashed #cbd5e1;
      border-radius: 10px;
      padding: 10px;
      min-height: 80px;
      margin-bottom: 14px;
      background: #f8fafc;
      font-size: 14px;
    }
    .file-box .file {
      padding: 6px 8px;
      background: #e2e8f0;
      border-radius: 6px;
      margin-bottom: 6px;
    }
    .file-box .empty { color: #64748b; }

    .progress {
      width: 100%;
      height: 10px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 12px;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#22c55e,#16a34a);
      transition: width .3s;
    }
    .progress-text {
      font-size: 13px;
      margin-top: 6px;
      color: #475569;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>üì§ GitHub File Uploader</h2>
  <p>Upload nhi·ªÅu file l√™n repo <b>file</b></p>

  <input type="file" id="files" multiple>

  <div class="file-box" id="fileBox">
    <p class="empty">Ch∆∞a c√≥ file n√†o ƒë∆∞·ª£c ch·ªçn</p>
  </div>

  <button id="btn" onclick="upload()">üíæ L∆∞u & Upload</button>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="progress-text" id="progressText"></div>

  <div class="links" id="links"></div>
</div>

<div class="overlay" id="overlay">
  <div class="popup" id="popup"></div>
</div>

<script>
const fileInput = document.getElementById('files');
const fileBox = document.getElementById('fileBox');
const progressBar = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');

fileInput.onchange = () => {
  const fs = [...fileInput.files];
  if (!fs.length) {
    fileBox.innerHTML = '<p class="empty">Ch∆∞a c√≥ file n√†o ƒë∆∞·ª£c ch·ªçn</p>';
    return;
  }
  fileBox.innerHTML = fs.map(f => `<div class="file">üìÑ ${f.name} (${(f.size/1024).toFixed(1)} KB)</div>`).join('');
};

function setProgress(p, text) {
  progressBar.style.width = p + '%';
  progressText.innerText = text;
}

function logDecode(msg) {
  const popup = document.getElementById('popup');
  const overlay = document.getElementById('overlay');
  popup.className = 'popup';
  popup.innerHTML = `<b>üîç Decode preview</b><br><pre style="text-align:left;max-height:180px;overflow:auto">${msg}</pre>`;
  overlay.style.display = 'flex';
}

function showPopup(type, msg) {
  const overlay = document.getElementById('overlay');
  const popup = document.getElementById('popup');
  popup.className = 'popup ' + type;
  popup.innerHTML = msg;
  overlay.style.display = 'flex';
  setTimeout(() => overlay.style.display = 'none', 2600);
}

async function upload() {
  const fs = [...fileInput.files];
  if (!fs.length) return showPopup('error', '‚ùå Ch∆∞a ch·ªçn file');

  btn.disabled = true;
  setProgress(5, 'Chu·∫©n b·ªã d·ªØ li·ªáu...');

  const data = [];
  let done = 0;

  for (const f of fs) {
    const buf = await f.arrayBuffer();
    const bytes = new Uint8Array(buf);
    const base64 = btoa(String.fromCharCode(...bytes));

    // preview decode
    let preview = '';
    try {
      preview = new TextDecoder().decode(bytes.slice(0, 200));
    } catch {
      preview = '[Binary data]';
    }

    logDecode(`File: ${f.name}\nSize: ${f.size} bytes\nPreview (first 200 bytes):\n${preview}`);

    data.push({ name: f.name, content: base64 });
    done++;
    setProgress(5 + Math.round(done/fs.length * 40), `ƒê√£ decode ${done}/${fs.length} file`);

    await new Promise(r => setTimeout(r, 800));
  });
    done++;
    setProgress(5 + Math.round(done/fs.length * 40), `ƒêang x·ª≠ l√Ω file ${done}/${fs.length}`);
  }

  try {
    setProgress(55, 'G·ª≠i y√™u c·∫ßu l√™n GitHub Actions...');

    await fetch(
      'https://api.github.com/repos/ntnhan306/ndlms/actions/workflows/upload.yml/dispatches',
      {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer YOUR_WORKFLOW_TOKEN',
          'Accept': 'application/vnd.github+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          ref: 'main',
          inputs: { files: JSON.stringify(data) }
        })
      }
    );

    setProgress(100, 'Ho√†n t·∫•t ‚Äì workflow ƒëang ch·∫°y');
    overlay.style.display = 'none';
    showPopup('success', '‚úÖ ƒê√£ encode & g·ª≠i to√†n b·ªô file th√†nh c√¥ng');

    links.innerHTML = fs.map(f =>
      `<a target="_blank" href="https://raw.githubusercontent.com/ntnhan306/file/main/${f.name}">${f.name}</a>`
    ).join('');

  } catch (e) {
    showPopup('error', '‚ùå Upload th·∫•t b·∫°i');
    setProgress(0, '');
  }

  btn.disabled = false;
}
</script>

</body>
</html>
