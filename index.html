<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File L√™n Repo ƒê√≠ch</title>
    <style>
        /* CSS t∆∞∆°ng t·ª± c√°c phi√™n b·∫£n tr∆∞·ªõc */
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; background-color: #f9f9f9; }
        h2 { color: #333; border-bottom: 2px solid #ccc; padding-bottom: 10px; }
        input[type="text"], input[type="file"], button { width: 100%; padding: 12px; margin-bottom: 15px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
        button { background-color: #2da44e; color: white; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #2c974b; }
        #output { border: 1px solid #ccc; padding: 15px; min-height: 80px; white-space: pre-wrap; background-color: #fff; border-radius: 4px; overflow-x: auto; font-size: 0.9em; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        .info { background-color: #e6f7ff; padding: 10px; border-left: 5px solid #007bff; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h2>üöÄ Upload File L√™n Kho L∆∞u Tr·ªØ ƒê√≠ch</h2>
    
    <div class="info">
        ‚úÖ **Repo Ch·ª©a App (A):** `ntnhan306/ndlms`<br>
        ‚úÖ **Repo ƒê√≠ch (B):** `ntnhan306/file` (File s·∫Ω ƒë∆∞·ª£c commit v√†o ƒë√¢y)<br>
        *H·ªá th·ªëng s·ª≠ d·ª•ng Serverless Gateway (trong Repo A) ƒë·ªÉ k√≠ch ho·∫°t Action (trong Repo A) commit v√†o Repo B.*
    </div>

    <label for="target_owner">Ch·ªß S·ªü H·ªØu Repo ƒê√≠ch (Owner):</label>
    <input type="text" id="target_owner" value="ntnhan306" readonly required>

    <label for="target_repo">T√™n Kho L∆∞u Tr·ªØ ƒê√≠ch (Repo):</label>
    <input type="text" id="target_repo" value="file" readonly required>

    <label for="branch">T√™n Nh√°nh ƒê√≠ch (Branch):</label>
    <input type="text" id="branch" value="main" required>

    <label for="files">Ch·ªçn File (C√≥ th·ªÉ ch·ªçn nhi·ªÅu file):</label>
    <input type="file" id="files" multiple required>

    <button onclick="uploadFiles()">Commit v√† Upload (N·ªôi dung commit: ".")</button>

    <h3>üìù K·∫øt Qu·∫£ v√† Link Raw:</h3>
    <div id="output">Ch·ªù ƒë·ª£i thao t√°c upload...</div>

    <script>
        // ‚ö†Ô∏è THAY TH·∫æ D√íNG N√ÄY B·∫∞NG URL SERVERLESS FUNCTION ƒê√É TRI·ªÇN KHAI C·ª¶A B·∫†N ‚ö†Ô∏è
        // Serverless Function n√†y ph·∫£i ƒë∆∞·ª£c host t·ª´ repo 'ntnhan306/ndlms'
        const BACKEND_UPLOAD_ENDPOINT = 'https://[YOUR_SERVERLESS_APP_URL]/api/trigger-action'; 
        const COMMIT_MESSAGE = '.';

        // Th√¥ng tin Repo Ngu·ªìn (Action s·∫Ω ƒë∆∞·ª£c k√≠ch ho·∫°t t·∫°i ƒë√¢y)
        const SOURCE_OWNER = 'ntnhan306';
        const SOURCE_REPO = 'ndlms';

        async function uploadFiles() {
            const targetOwner = document.getElementById('target_owner').value.trim();
            const targetRepo = document.getElementById('target_repo').value.trim();
            const branch = document.getElementById('branch').value.trim();
            const fileInput = document.getElementById('files');
            const outputDiv = document.getElementById('output');
            
            outputDiv.innerHTML = '<span style="color: blue;">ƒêang x·ª≠ l√Ω... ƒêang g·ª≠i y√™u c·∫ßu k√≠ch ho·∫°t GitHub Action.</span>';

            if (fileInput.files.length === 0) {
                outputDiv.innerHTML = '<span style="color: red;">Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt file.</span>';
                return;
            }

            const formData = new FormData();
            // Truy·ªÅn th√¥ng tin repo NGU·ªíN (ƒë·ªÉ Action bi·∫øt n∆°i n√≥ ƒëang ch·∫°y)
            formData.append('source_owner', SOURCE_OWNER);
            formData.append('source_repo', SOURCE_REPO);
            // Truy·ªÅn th√¥ng tin repo ƒê√çCH (n∆°i file s·∫Ω ƒë∆∞·ª£c commit)
            formData.append('target_owner', targetOwner);
            formData.append('target_repo', targetRepo);
            formData.append('branch', branch);

            for (const file of fileInput.files) {
                formData.append('files', file, file.name); 
            }
            
            try {
                const response = await fetch(BACKEND_UPLOAD_ENDPOINT, {
                    method: 'POST',
                    body: formData 
                });

                const result = await response.json();

                if (response.ok) {
                    const actionUrl = `https://github.com/${SOURCE_OWNER}/${SOURCE_REPO}/actions`;
                    outputDiv.innerHTML = `
                        <span style="color: green; font-weight: bold;">‚úÖ Y√™u c·∫ßu ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn GitHub Actions (Repo ${SOURCE_REPO})!</span><br>
                        ${result.message || 'Ki·ªÉm tra tr·∫°ng th√°i commit trong Actions.'}<br>
                        <a href="${actionUrl}" target="_blank">Xem ti·∫øn tr√¨nh Action t·∫°i ƒë√¢y</a>
                    `;
                } else {
                    outputDiv.innerHTML = `<span style="color: red;">‚ùå L·ªói Gateway (${response.status}):</span> ${result.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh.'}\n\n<span style="font-style: italic;">Chi ti·∫øt l·ªói:</span> ${JSON.stringify(result.detail || result, null, 2)}`;
                }

            } catch (error) {
                console.error('L·ªói khi g·ª≠i y√™u c·∫ßu:', error);
                outputDiv.innerHTML = `<span style="color: red;">‚ùå L·ªói k·∫øt n·ªëi:</span> Vui l√≤ng ƒë·∫£m b·∫£o Serverless Gateway ƒëang ho·∫°t ƒë·ªông. (${error.message})`;
            }
        }
    </script>
</body>
</html>
