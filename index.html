<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File L√™n GitHub</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; background-color: #f9f9f9; }
        h2 { color: #333; border-bottom: 2px solid #ccc; padding-bottom: 10px; }
        input[type="text"], input[type="file"], button { width: 100%; padding: 12px; margin-bottom: 15px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
        button { background-color: #2da44e; color: white; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #2c974b; }
        #output { border: 1px solid #ccc; padding: 15px; min-height: 80px; white-space: pre-wrap; background-color: #fff; border-radius: 4px; overflow-x: auto; font-size: 0.9em; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
    </style>
</head>
<body>
    <h2>üöÄ C√¥ng C·ª• Upload File L√™n GitHub</h2>
    
    <label for="owner">T√™n Ch·ªß S·ªü H·ªØu (Owner):</label>
    <input type="text" id="owner" placeholder="V√≠ d·ª•: myusername" required>

    <label for="repo">T√™n Kho L∆∞u Tr·ªØ (Repo):</label>
    <input type="text" id="repo" placeholder="V√≠ d·ª•: my-project-repo" required>

    <label for="branch">T√™n Nh√°nh (Branch):</label>
    <input type="text" id="branch" value="main" required>

    <label for="files">Ch·ªçn File (C√≥ th·ªÉ ch·ªçn nhi·ªÅu file):</label>
    <input type="file" id="files" multiple required>

    <button onclick="uploadFiles()">Commit v√† Upload (N·ªôi dung commit: ".")</button>

    <h3>üìù K·∫øt Qu·∫£ v√† Link Raw:</h3>
    <div id="output">Ch·ªù ƒë·ª£i thao t√°c upload...</div>

    <script>
        // ƒê·ªãa ch·ªâ n√†y ph·∫£i l√† ƒë·ªãa ch·ªâ c·ªßa server b·∫°n ƒë√£ tri·ªÉn khai (v√≠ d·ª•: Vercel, Heroku, EC2...)
        const BACKEND_UPLOAD_ENDPOINT = 'http://localhost:3000/api/upload-github'; 
        const COMMIT_MESSAGE = '.';

        async function uploadFiles() {
            const owner = document.getElementById('owner').value.trim();
            const repo = document.getElementById('repo').value.trim();
            const branch = document.getElementById('branch').value.trim();
            const fileInput = document.getElementById('files');
            const outputDiv = document.getElementById('output');
            
            outputDiv.innerHTML = '<span style="color: blue;">ƒêang x·ª≠ l√Ω... Vui l√≤ng ch·ªù.</span>';

            if (!owner || !repo || fileInput.files.length === 0) {
                outputDiv.innerHTML = '<span style="color: red;">Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß Owner, Repo v√† ch·ªçn √≠t nh·∫•t m·ªôt file.</span>';
                return;
            }

            const formData = new FormData();
            formData.append('owner', owner);
            formData.append('repo', repo);
            formData.append('branch', branch);
            formData.append('commitMessage', COMMIT_MESSAGE);

            for (const file of fileInput.files) {
                formData.append('files', file, file.name); 
            }
            
            try {
                const response = await fetch(BACKEND_UPLOAD_ENDPOINT, {
                    method: 'POST',
                    body: formData 
                });

                const result = await response.json();

                if (response.ok) {
                    let rawLinks = "‚úÖ **Upload th√†nh c√¥ng!** D∆∞·ªõi ƒë√¢y l√† c√°c link raw:\n\n";
                    if (result.rawUrls && Array.isArray(result.rawUrls)) {
                         result.rawUrls.forEach(url => {
                            rawLinks += `- ${url}\n`;
                        });
                    } else {
                        rawLinks += "‚ö†Ô∏è Kh√¥ng nh·∫≠n ƒë∆∞·ª£c danh s√°ch link raw t·ª´ server.";
                    }
                    outputDiv.textContent = rawLinks;

                } else {
                    outputDiv.innerHTML = `<span style="color: red;">‚ùå L·ªói Upload (${response.status}):</span> ${result.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh.'}\n\n<span style="font-style: italic;">Chi ti·∫øt l·ªói:</span> ${JSON.stringify(result.detail || result, null, 2)}`;
                }

            } catch (error) {
                console.error('L·ªói khi g·ª≠i y√™u c·∫ßu:', error);
                outputDiv.innerHTML = `<span style="color: red;">‚ùå L·ªói k·∫øt n·ªëi:</span> Vui l√≤ng ƒë·∫£m b·∫£o server backend ƒëang ch·∫°y. (${error.message})`;
            }
        }
    </script>
</body>
</html>
